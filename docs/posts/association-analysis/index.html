<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us" lang="en-us">
<head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="generator" content="Hugo 0.31.1" />

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  
  <title>Association Rules Mining Using Python Generators to Handle Large Datasets &middot; datathèque</title>
  

  
  <link rel="stylesheet" href="/css/print.css" media="print">
  <link rel="stylesheet" href="/css/poole.css">
  <link rel="stylesheet" href="/css/syntax.css">
  <link rel="stylesheet" href="/css/hyde.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">
  <link rel="stylesheet" href="/css/custom.css">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/favicon.png">

  
  <link href="" rel="alternate" type="application/rss+xml" title="datathèque" />

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS_HTML"></script>
  
  <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
      tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"] ],
          displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
          processEscapes: true,
          processEnvironments: true
      },
      // Center justify equations in code and markdown cells. Elsewhere
      // we use CSS to left justify single line equations in code cells.
      displayAlign: 'center',
      "HTML-CSS": {
          styles: {'.MathJax_Display': {"margin": 0}},
          linebreaks: { automatic: true }
      }
  });
  </script>
</head>

<body class=" ">
  <div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <a href="/">
        <h1>datathèque</h1>
      </a>
      <p class="lead">
        data scientist, francophile, budding graphista, currently data science-ing at Drop
      </p>
    </div>

    <ul class="sidebar-nav">
      <li><a href="/">Blog</a> </li>
      
      <li><a href="/about/"> About Me </a></li>
      
    </ul>

    <ul class="social-icons">
      <li>
        <a href="https://github.com/datatheque">
          <svg id="icon-github" class="icon" viewBox="0 0 32 32">
            <title>github</title>
            <path d="M16 0c-8.84 0-16 7.164-16 16 0 7.070 4.584 13.066 10.94 15.18 0.8 0.15 1.094-0.344 1.094-0.77 0-0.38-0.014-1.386-0.020-2.72-4.452 0.966-5.39-2.146-5.39-2.146-0.728-1.848-1.78-2.34-1.78-2.34-1.45-0.992 0.112-0.972 0.112-0.972 1.606 0.112 2.45 1.648 2.45 1.648 1.428 2.446 3.746 1.74 4.66 1.33 0.144-1.034 0.556-1.74 1.014-2.14-3.554-0.4-7.288-1.776-7.288-7.906 0-1.746 0.62-3.174 1.646-4.294-0.18-0.404-0.72-2.030 0.14-4.234 0 0 1.34-0.43 4.4 1.64 1.28-0.356 2.64-0.532 4-0.54 1.36 0.008 2.72 0.184 4 0.54 3.040-2.070 4.38-1.64 4.38-1.64 0.86 2.204 0.32 3.83 0.16 4.234 1.020 1.12 1.64 2.548 1.64 4.294 0 6.146-3.74 7.5-7.3 7.894 0.56 0.48 1.080 1.46 1.080 2.96 0 2.14-0.020 3.86-0.020 4.38 0 0.42 0.28 0.92 1.1 0.76 6.402-2.098 10.982-8.098 10.982-15.158 0-8.836-7.164-16-16-16z"></path>
          </svg>
        </a>
      </li>
      <li>
        <a href="https://www.kaggle.com/datatheque">
          <svg id="icon-kaggle" class="icon" viewBox="0 0 32 32">
            <title>kaggle</title>
            <path d="M25.1 31.812c-0.030 0.124-0.156 0.188-0.374 0.188h-4.186c-0.248 0-0.468-0.11-0.656-0.33l-6.904-8.786-1.93 1.832v6.814c0 0.314-0.156 0.47-0.47 0.47h-3.24c-0.316 0-0.472-0.156-0.472-0.47v-31.060c0-0.31 0.156-0.47 0.472-0.47h3.24c0.314 0 0.47 0.16 0.47 0.47v19.124l8.27-8.364c0.22-0.22 0.44-0.328 0.66-0.328h4.32c0.19 0 0.314 0.080 0.38 0.24 0.060 0.2 0.046 0.34-0.048 0.42l-8.74 8.46 9.114 11.34c0.126 0.14 0.156 0.28 0.094 0.48z"></path>
          </svg>
        </a>
      </li>
      <li>
        <a href="https://twitter.com/datatheque">
          <svg id="icon-twitter" class="icon" viewBox="0 0 32 32">
            <title>twitter</title>
            <path d="M32 6.076c-1.18 0.52-2.44 0.874-3.77 1.034 1.354-0.814 2.396-2.1 2.886-3.632-1.268 0.74-2.674 1.28-4.17 1.58-1.196-1.28-2.9-2.080-4.792-2.080-3.624 0-6.564 2.94-6.564 6.56 0 0.52 0.060 1.020 0.17 1.5-5.456-0.26-10.294-2.88-13.532-6.84-0.568 0.962-0.888 2.082-0.888 3.302 0 2.28 1.16 4.286 2.92 5.464-1.076-0.034-2.090-0.33-2.974-0.82v0.080c0 3.18 2.26 5.836 5.266 6.44-0.552 0.148-1.132 0.228-1.73 0.228-0.42 0-0.82-0.040-1.22-0.116 0.84 2.608 3.26 4.506 6.14 4.56-2.24 1.76-5.080 2.808-8.14 2.808-0.52 0-1.040-0.030-1.56-0.090 2.92 1.86 6.36 2.948 10.080 2.948 12.080 0 18.68-10 18.68-18.66 0-0.28 0-0.56-0.020-0.84 1.28-0.92 2.4-2.080 3.28-3.4z"></path>
          </svg>
        </a>
      </li>
      <li>
        <a href="https://www.linkedin.com/in/gracetenorio/">
          <svg id="icon-linkedin" class="icon" viewBox="0 0 32 32">
            <title>linkedin</title>
            <path d="M12 12h5.535v2.837h0.079c0.77-1.381 2.655-2.837 5.464-2.837 5.842 0 6.922 3.637 6.922 8.367v9.633h-5.769v-8.54c0-2.037-0.042-4.657-3.001-4.657-3.005 0-3.463 2.218-3.463 4.509v8.688h-5.767v-18z"></path>
            <path d="M2 12h6v18h-6v-18z"></path>
            <path d="M8 7c0 1.657-1.343 3-3 3s-3-1.343-3-3c0-1.657 1.343-3 3-3s3 1.343 3 3z"></path>
          </svg>
        </a>
      </li>
    </ul>

    <p class="copyright">&copy; 2019. All rights reserved. </p>
  </div>
</div>

  <div class="content container">
    <div class="post">
      <h1>Association Rules Mining Using Python Generators to Handle Large Datasets</h1>
      <span class="post-date">Tue, Sep 12, 2017</span>
      <div class="cell border-box-sizing text_cell rendered">
  <div class="inner_cell">
    <div class="text_cell_render border-box-sizing rendered_html">
      <h3 id="Motivation">Motivation<a class="anchor-link" href="#Motivation">&#182;</a></h3>
      <p>I was looking to run association analysis in Python using the apriori algorithm to derive rules of the form {A} -&gt;
        {B}. However, I quickly discovered that it's not part of the standard Python machine learning libraries. Although
        there are some implementations that exist, I could not find one capable of handling large datasets. "Large" in my
        case was an orders dataset with 32 million records, containing 3.2 million unique orders and about 50K unique items
        (file size just over 1 GB). So, I decided to write my own implementation, leveraging the apriori algorithm to generate
        simple {A} -&gt; {B} association rules. Since I only care about understanding relationships between any given pair
        of items, using apriori to get to item sets of size 2 is sufficient. I went through various iterations, splitting
        the data into multiple subsets just so I could get functions like crosstab and combinations to run on my machine
        with 8 GB of memory. :) But even with this approach, I could only process about 1800 items before my kernel would
        crash... And that's when I learned about the wonderful world of Python generators.</p>
    </div>
  </div>
</div>
<div class="cell border-box-sizing text_cell rendered">
  <div class="prompt input_prompt"></div>
  <div class="inner_cell">
    <div class="text_cell_render border-box-sizing rendered_html">
      <h3 id="Python-Generators">Python Generators<a class="anchor-link" href="#Python-Generators">&#182;</a></h3>
      <p>In a nutshell, a generator is a special type of function that returns an iterable sequence of items. However, unlike
        regular functions which return all the values at once (eg: returning all the elements of a list), a generator <i>yields</i>        one value at a time. To get the next value in the set, we must ask for it - either by explicitly calling the generator's
        built-in "next" method, or implicitly via a for loop. This is a great property of generators because it means that
        we don't have to store all of the values in memory at once. We can load and process one value at a time, discard
        when finished and move on to process the next value. This feature makes generators perfect for creating item pairs
        and counting their frequency of co-occurence. Here's a concrete example of what we're trying to accomplish:</p>
      <ol>
        <li>
          <p>Get all possible item pairs for a given order</p>

          <pre><code>eg:  order 1:  apple, egg, milk    --&gt;  item pairs: {apple, egg}, {apple, milk}, {egg, milk}
     order 2:  egg, milk           --&gt;  item pairs: {egg, milk}</code></pre>
        </li>
        <li>
          <p>Count the number of times each item pair appears</p>

          <pre><code>eg: {apple, egg}: 1
    {apple, milk}: 1
    {egg, milk}: 2</code></pre>
        </li>
      </ol>
      <p>Here's the generator that implements the above tasks:</p>

    </div>
  </div>
</div>
<div class="cell border-box-sizing code_cell rendered">
  <div class="input">
    <div class="prompt input_prompt">In&nbsp;[1]:</div>
    <div class="inner_cell">
      <div class="input_area">
        <div class=" highlight hl-ipython3">
          <pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="k">import</span> <span class="n">combinations</span><span class="p">,</span> <span class="n">groupby</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">Counter</span>

<span class="c1"># Sample data</span>
<span class="n">orders</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;apple&#39;</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;egg&#39;</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;milk&#39;</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;egg&#39;</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;milk&#39;</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span>

<span class="c1"># Generator that yields item pairs, one at a time</span>
<span class="k">def</span> <span class="nf">get_item_pairs</span><span class="p">(</span><span class="n">order_item</span><span class="p">):</span>
    
    <span class="c1"># For each order, generate a list of items in that order</span>
    <span class="k">for</span> <span class="n">order_id</span><span class="p">,</span> <span class="n">order_object</span> <span class="ow">in</span> <span class="n">groupby</span><span class="p">(</span><span class="n">orders</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="n">item_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">order_object</span><span class="p">]</span>      
    
        <span class="c1"># For each item list, generate item pairs, one at a time</span>
        <span class="k">for</span> <span class="n">item_pair</span> <span class="ow">in</span> <span class="n">combinations</span><span class="p">(</span><span class="n">item_list</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
            <span class="k">yield</span> <span class="n">item_pair</span>                                      


<span class="c1"># Counter iterates through the item pairs returned by our generator and keeps a tally of their occurrence</span>
<span class="n">Counter</span><span class="p">(</span><span class="n">get_item_pairs</span><span class="p">(</span><span class="n">orders</span><span class="p">))</span>
</pre>
        </div>

      </div>
    </div>
  </div>

  <div class="output_wrapper">
    <div class="output">


      <div class="output_area">

        <div class="prompt output_prompt">Out[1]:</div>




        <div class="output_text output_subarea output_execute_result">
          <pre>Counter({(&#39;apple&#39;, &#39;egg&#39;): 1, (&#39;apple&#39;, &#39;milk&#39;): 1, (&#39;egg&#39;, &#39;milk&#39;): 2})</pre>
        </div>

      </div>

    </div>
  </div>

</div>
<div class="cell border-box-sizing text_cell rendered">
  <div class="prompt input_prompt">
  </div>
  <div class="inner_cell">
    <div class="text_cell_render border-box-sizing rendered_html">
      <p><i>get_item_pairs()</i> generates a list of items for each order and produces item pairs for that order, one pair at
        a time. The first item pair is passed to Counter which keeps track of the number of times an item pair occurs. The
        next item pair is taken, and again, passed to Counter. This process continues until there are no more item pairs
        left. With this approach, we end up not using much memory as item pairs are discarded after the count is updated.</p>

    </div>
  </div>
</div>
<div class="cell border-box-sizing text_cell rendered">
  <div class="prompt input_prompt">
  </div>
  <div class="inner_cell">
    <div class="text_cell_render border-box-sizing rendered_html">
      <h3 id="Apriori-Algorithm">Apriori Algorithm<a class="anchor-link" href="#Apriori-Algorithm">&#182;</a></h3>
      <p>Apriori is an algorithm used to identify frequent item sets (in our case, item pairs). It does so using a "bottom up"
        approach, first identifying individual items that satisfy a minimum occurence threshold. It then extends the item
        set, adding one item at a time and checking if the resulting item set still satisfies the specified threshold. The
        algorithm stops when there are no more items to add that meet the minimum occurrence requirement. Here's an example
        of apriori in action, assuming a minimum occurence threshold of 3:</p>

      <pre><code>order 1: apple, egg, milk  
order 2: carrot, milk  
order 3: apple, egg, carrot
order 4: apple, egg
order 5: apple, carrot


Iteration 1:  Count the number of times each item occurs   
item set      occurrence count    
{apple}              4   
{egg}                3   
{milk}               2   
{carrot}             2   

{milk} and {carrot} are eliminated because they do not meet the minimum occurrence threshold.


Iteration 2: Build item sets of size 2 using the remaining items from Iteration 1 (ie: apple, egg)  
item set           occurence count  
{apple, egg}             3  

Only {apple, egg} remains and the algorithm stops since there are no more items to add.</code></pre>
      <p>If we had more orders and items, we can continue to iterate, building item sets consisting of more than 2 elements.
        For the problem we are trying to solve (ie: finding relationships between pairs of items), it suffices to implement
        apriori to get to item sets of size 2.</p>

    </div>
  </div>
</div>
<div class="cell border-box-sizing text_cell rendered">
  <div class="prompt input_prompt">
  </div>
  <div class="inner_cell">
    <div class="text_cell_render border-box-sizing rendered_html">
      <h3 id="Association-Rules-Mining">Association Rules Mining<a class="anchor-link" href="#Association-Rules-Mining">&#182;</a></h3>
      <p>Once the item sets have been generated using apriori, we can start mining association rules. Given that we are only
        looking at item sets of size 2, the association rules we will generate will be of the form {A} -&gt; {B}. One common
        application of these rules is in the domain of recommender systems, where customers who purchased item A are recommended
        item B.</p>
      <p>Here are 3 key metrics to consider when evaluating association rules:</p>
      <ol>
        <li>
          <p><b>support</b><br> This is the percentage of orders that contains the item set. In the example above, there are
            5 orders in total and {apple,egg} occurs in 3 of them, so:</p>

          <pre><code>             support{apple,egg} = 3/5 or 60%</code></pre>
          <p>The minimum support threshold required by apriori can be set based on knowledge of your domain. In this grocery
            dataset for example, since there could be thousands of distinct items and an order can contain only a small fraction
            of these items, setting the support threshold to 0.01% may be reasonable.</p>
        </li>
        <li>
          <p><b>confidence</b><br> Given two items, A and B, confidence measures the percentage of times that item B is purchased,
            given that item A was purchased. This is expressed as:</p>

          <pre><code>             confidence{A-&gt;B} = support{A,B} / support{A}</code></pre>
          <p>Confidence values range from 0 to 1, where 0 indicates that B is never purchased when A is purchased, and 1 indicates
            that B is always purchased whenever A is purchased. Note that the confidence measure is directional. This means
            that we can also compute the percentage of times that item A is purchased, given that item B was purchased:
          </p>

          <pre><code>             confidence{B-&gt;A} = support{A,B} / support{B}</code></pre>
          <p>In our example, the percentage of times that egg is purchased, given that apple was purchased is:</p>

          <pre><code>             confidence{apple-&gt;egg} = support{apple,egg} / support{apple}
                                    = (3/5) / (4/5)
                                    = 0.75 or 75%</code></pre>
          <p>A confidence value of 0.75 implies that out of all orders that contain apple, 75% of them also contain egg. Now,
            we look at the confidence measure in the opposite direction (ie: egg-&gt;apple):</p>

          <pre><code>             confidence{egg-&gt;apple} = support{apple,egg} / support{egg}
                                    = (3/5) / (3/5)
                                    = 1 or 100%  </code></pre>
          <p>Here we see that all of the orders that contain egg also contain apple. But, does this mean that there is a relationship
            between these two items, or are they occurring together in the same orders simply by chance? To answer this question,
            we look at another measure which takes into account the popularity of <i>both</i> items.</p>
        </li>
        <li>
          <p><b>lift</b><br> Given two items, A and B, lift indicates whether there is a relationship between A and B, or whether
            the two items are occuring together in the same orders simply by chance (ie: at random). Unlike the confidence
            metric whose value may vary depending on direction (eg: confidence{A-&gt;B} may be different from confidence{B-&gt;A}),
            lift has no direction. This means that the lift{A,B} is always equal to the lift{B,A}:</p>

          <pre><code>             lift{A,B} = lift{B,A} = support{A,B} / (support{A} * support{B})</code></pre>
          <p>In our example, we compute lift as follows:</p>

          <pre><code>             lift{apple,egg} = lift{egg,apple} = support{apple,egg} / (support{apple} * support{egg})
                                               = (3/5) / (4/5 * 3/5) 
                                               = 1.25</code></pre>
          <p>One way to understand lift is to think of the denominator as the likelihood that A and B will appear in the same
            order if there was <i>no</i> relationship between them. In the example above, if apple occurred in 80% of the
            orders and egg occurred in 60% of the orders, then if there was no relationship between them, we would
            <i>expect</i> both of them to show up together in the same order 48% of the time (ie: 80% * 60%). The numerator,
            on the other hand, represents how often apple and egg <i>actually</i> appear together in the same order. In this
            example, that is 60% of the time. Taking the numerator and dividing it by the denominator, we get to how many
            more times apple and egg actually appear in the same order, compared to if there was no relationship between
            them (ie: that they are occurring together simply at random).</p>
          <p>In summary, lift can take on the following values:</p>

          <pre><code> * lift = 1 implies no relationship between A and B. 
   (ie: A and B occur together only by chance)

 * lift &gt; 1 implies that there is a positive relationship between A and B.
   (ie:  A and B occur together more often than random)

 * lift &lt; 1 implies that there is a negative relationship between A and B.
   (ie:  A and B occur together less often than random)</code></pre>
          <p>In our example, apple and egg occur together 1.25 times <i>more</i> than random, so we conclude that there exists
            a positive relationship between them.</p>
        </li>
      </ol>
      <p>Armed with knowledge of apriori and association rules mining, let's dive into the data and code to see what relationships
        we unravel!</p>

    </div>
  </div>
</div>
<div class="cell border-box-sizing text_cell rendered">
  <div class="prompt input_prompt">
  </div>
  <div class="inner_cell">
    <div class="text_cell_render border-box-sizing rendered_html">
      <h3 id="Input-Dataset">Input Dataset<a class="anchor-link" href="#Input-Dataset">&#182;</a></h3>
      <p>Instacart, an online grocer, has graciously made some of their datasets accessible to the public. The order and product
        datasets that we will be using can be downloaded from the link below, along with the data dictionary:</p>
      <p class="align-left">“The Instacart Online Grocery Shopping Dataset 2017”, Accessed from <a href="https://www.instacart.com/datasets/grocery-shopping-2017">https://www.instacart.com/datasets/grocery-shopping-2017</a> on September 1, 2017.</p>
    </div>
  </div>
</div>
<div class="cell border-box-sizing code_cell rendered">
  <div class="input">
    <div class="prompt input_prompt">In&nbsp;[2]:</div>
    <div class="inner_cell">
      <div class="input_area">
        <div class=" highlight hl-ipython3">
          <pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="k">import</span> <span class="n">combinations</span><span class="p">,</span> <span class="n">groupby</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">Counter</span>
</pre>
        </div>

      </div>
    </div>
  </div>

</div>
<div class="cell border-box-sizing code_cell rendered">
  <div class="input">
    <div class="prompt input_prompt">In&nbsp;[3]:</div>
    <div class="inner_cell">
      <div class="input_area">
        <div class=" highlight hl-ipython3">
          <pre><span></span><span class="c1"># Function that returns the size of an object in MB</span>
<span class="k">def</span> <span class="nf">size</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
    <span class="k">return</span> <span class="s2">&quot;</span><span class="si">{0:.2f}</span><span class="s2"> MB&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">getsizeof</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1000</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">))</span>
</pre>
        </div>

      </div>
    </div>
  </div>

</div>
<div class="cell border-box-sizing text_cell rendered">
  <div class="prompt input_prompt">
  </div>
  <div class="inner_cell">
    <div class="text_cell_render border-box-sizing rendered_html">
      <h3 id="Part-1:--Data-Preparation">Part 1: Data Preparation<a class="anchor-link" href="#Part-1:--Data-Preparation">&#182;</a></h3>
    </div>
  </div>
</div>
<div class="cell border-box-sizing text_cell rendered">
  <div class="prompt input_prompt">
  </div>
  <div class="inner_cell">
    <div class="text_cell_render border-box-sizing rendered_html">
      <h4 id="A.-Load-order--data">A. Load order data<a class="anchor-link" href="#A.-Load-order--data">&#182;</a></h4>
    </div>
  </div>
</div>
<div class="cell border-box-sizing code_cell rendered">
  <div class="input">
    <div class="prompt input_prompt">In&nbsp;[4]:</div>
    <div class="inner_cell">
      <div class="input_area">
        <div class=" highlight hl-ipython3">
          <pre><span></span><span class="n">orders</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;order_products__prior.csv&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;orders -- dimensions: </span><span class="si">{0}</span><span class="s1">;   size: </span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">orders</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">size</span><span class="p">(</span><span class="n">orders</span><span class="p">)))</span>
<span class="n">display</span><span class="p">(</span><span class="n">orders</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre>
        </div>

      </div>
    </div>
  </div>

  <div class="output_wrapper">
    <div class="output">


      <div class="output_area">

        <div class="prompt"></div>


        <div class="output_subarea output_stream output_stdout output_text">
          <pre>orders -- dimensions: (32434489, 4);   size: 1037.90 MB
</pre>
        </div>
      </div>

      <div class="output_area">

        <div class="prompt"></div>



        <div class="output_html rendered_html output_subarea ">
          <div>
            <style>
              .dataframe thead tr:only-child th {
                text-align: right;
              }

              .dataframe thead th {
                text-align: left;
              }

              .dataframe tbody tr th {
                vertical-align: top;
              }
            </style>
            <table border="1" class="dataframe">
              <thead>
                <tr style="text-align: right;">
                  <th></th>
                  <th>order_id</th>
                  <th>product_id</th>
                  <th>add_to_cart_order</th>
                  <th>reordered</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <th>0</th>
                  <td>2</td>
                  <td>33120</td>
                  <td>1</td>
                  <td>1</td>
                </tr>
                <tr>
                  <th>1</th>
                  <td>2</td>
                  <td>28985</td>
                  <td>2</td>
                  <td>1</td>
                </tr>
                <tr>
                  <th>2</th>
                  <td>2</td>
                  <td>9327</td>
                  <td>3</td>
                  <td>0</td>
                </tr>
                <tr>
                  <th>3</th>
                  <td>2</td>
                  <td>45918</td>
                  <td>4</td>
                  <td>1</td>
                </tr>
                <tr>
                  <th>4</th>
                  <td>2</td>
                  <td>30035</td>
                  <td>5</td>
                  <td>0</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

      </div>

    </div>
  </div>

</div>
<div class="cell border-box-sizing text_cell rendered">
  <div class="prompt input_prompt">
  </div>
  <div class="inner_cell">
    <div class="text_cell_render border-box-sizing rendered_html">
      <h4 id="B.-Convert-order-data-into-format-expected-by-the-association-rules-function">B. Convert order data into format expected by the association rules function<a class="anchor-link" href="#B.-Convert-order-data-into-format-expected-by-the-association-rules-function">&#182;</a></h4>
    </div>
  </div>
</div>
<div class="cell border-box-sizing code_cell rendered">
  <div class="input">
    <div class="prompt input_prompt">In&nbsp;[5]:</div>
    <div class="inner_cell">
      <div class="input_area">
        <div class=" highlight hl-ipython3">
          <pre><span></span><span class="c1"># Convert from DataFrame to a Series, with order_id as index and item_id as value</span>
<span class="n">orders</span> <span class="o">=</span> <span class="n">orders</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;order_id&#39;</span><span class="p">)[</span><span class="s1">&#39;product_id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s1">&#39;item_id&#39;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">orders</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
<span class="nb">type</span><span class="p">(</span><span class="n">orders</span><span class="p">)</span>
</pre>
        </div>
      </div>
    </div>
  </div>

  <div class="output_wrapper">
    <div class="output">
      <div class="output_area">
        <div class="prompt"></div>
        <div class="output_text output_subarea ">
          <pre>order_id
2    33120
2    28985
2     9327
2    45918
2    30035
2    17794
2    40141
2     1819
2    43668
3    33754
Name: item_id, dtype: int64

pandas.core.series.Series</pre>
        </div>
      </div>
    </div>
  </div>

</div>
<div class="cell border-box-sizing text_cell rendered">
  <div class="prompt input_prompt">
  </div>
  <div class="inner_cell">
    <div class="text_cell_render border-box-sizing rendered_html">
      <h4 id="C.-Display-summary-statistics-for-order-data">C. Display summary statistics for order data<a class="anchor-link" href="#C.-Display-summary-statistics-for-order-data">&#182;</a></h4>
    </div>
  </div>
</div>
<div class="cell border-box-sizing code_cell rendered">
  <div class="input">
    <div class="prompt input_prompt">In&nbsp;[6]:</div>
    <div class="inner_cell">
      <div class="input_area">
        <div class=" highlight hl-ipython3">
          <pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;orders -- dimensions: </span><span class="si">{0}</span><span class="s1">;   size: </span><span class="si">{1}</span><span class="s1">;   unique_orders: </span><span class="si">{2}</span><span class="s1">;   unique_items: </span><span class="si">{3}</span><span class="s1">&#39;</span>
      <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">orders</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">size</span><span class="p">(</span><span class="n">orders</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">orders</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">unique</span><span class="p">()),</span> <span class="nb">len</span><span class="p">(</span><span class="n">orders</span><span class="o">.</span><span class="n">value_counts</span><span class="p">())))</span>
</pre>
        </div>

      </div>
    </div>
  </div>

  <div class="output_wrapper">
    <div class="output">


      <div class="output_area">

        <div class="prompt"></div>


        <div class="output_subarea output_stream output_stdout output_text">
          <pre>orders -- dimensions: (32434489,);   size: 518.95 MB;   unique_orders: 3214874;   unique_items: 49677
</pre>
        </div>
      </div>

    </div>
  </div>

</div>
<div class="cell border-box-sizing text_cell rendered">
  <div class="prompt input_prompt">
  </div>
  <div class="inner_cell">
    <div class="text_cell_render border-box-sizing rendered_html">
      <h3 id="Part-2:-Association-Rules-Function">Part 2: Association Rules Function<a class="anchor-link" href="#Part-2:-Association-Rules-Function">&#182;</a></h3>
    </div>
  </div>
</div>
<div class="cell border-box-sizing text_cell rendered">
  <div class="prompt input_prompt">
  </div>
  <div class="inner_cell">
    <div class="text_cell_render border-box-sizing rendered_html">
      <h4 id="A.-Helper-functions-to-the-main-association-rules-function">A. Helper functions to the main association rules function<a class="anchor-link" href="#A.-Helper-functions-to-the-main-association-rules-function">&#182;</a></h4>
    </div>
  </div>
</div>
<div class="cell border-box-sizing code_cell rendered">
  <div class="input">
    <div class="prompt input_prompt">In&nbsp;[7]:</div>
    <div class="inner_cell">
      <div class="input_area">
        <div class=" highlight hl-ipython3">
          <pre><span></span><span class="c1"># Returns frequency counts for items and item pairs</span>
<span class="k">def</span> <span class="nf">freq</span><span class="p">(</span><span class="n">iterable</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">iterable</span><span class="p">)</span> <span class="o">==</span> <span class="n">pd</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">Series</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">iterable</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s2">&quot;freq&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span> 
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">Counter</span><span class="p">(</span><span class="n">iterable</span><span class="p">))</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s2">&quot;freq&quot;</span><span class="p">)</span>

    
<span class="c1"># Returns number of unique orders</span>
<span class="k">def</span> <span class="nf">order_count</span><span class="p">(</span><span class="n">order_item</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">order_item</span><span class="o">.</span><span class="n">index</span><span class="p">))</span>


<span class="c1"># Returns generator that yields item pairs, one at a time</span>
<span class="k">def</span> <span class="nf">get_item_pairs</span><span class="p">(</span><span class="n">order_item</span><span class="p">):</span>
    <span class="n">order_item</span> <span class="o">=</span> <span class="n">order_item</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">as_matrix</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">order_id</span><span class="p">,</span> <span class="n">order_object</span> <span class="ow">in</span> <span class="n">groupby</span><span class="p">(</span><span class="n">order_item</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="n">item_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">order_object</span><span class="p">]</span>
              
        <span class="k">for</span> <span class="n">item_pair</span> <span class="ow">in</span> <span class="n">combinations</span><span class="p">(</span><span class="n">item_list</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
            <span class="k">yield</span> <span class="n">item_pair</span>
            

<span class="c1"># Returns frequency and support associated with item</span>
<span class="k">def</span> <span class="nf">merge_item_stats</span><span class="p">(</span><span class="n">item_pairs</span><span class="p">,</span> <span class="n">item_stats</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">item_pairs</span>
                <span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">item_stats</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;freq&#39;</span><span class="p">:</span> <span class="s1">&#39;freqA&#39;</span><span class="p">,</span> <span class="s1">&#39;support&#39;</span><span class="p">:</span> <span class="s1">&#39;supportA&#39;</span><span class="p">}),</span> <span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;item_A&#39;</span><span class="p">,</span> <span class="n">right_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">item_stats</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;freq&#39;</span><span class="p">:</span> <span class="s1">&#39;freqB&#39;</span><span class="p">,</span> <span class="s1">&#39;support&#39;</span><span class="p">:</span> <span class="s1">&#39;supportB&#39;</span><span class="p">}),</span> <span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;item_B&#39;</span><span class="p">,</span> <span class="n">right_index</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>


<span class="c1"># Returns name associated with item</span>
<span class="k">def</span> <span class="nf">merge_item_name</span><span class="p">(</span><span class="n">rules</span><span class="p">,</span> <span class="n">item_name</span><span class="p">):</span>
    <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;itemA&#39;</span><span class="p">,</span><span class="s1">&#39;itemB&#39;</span><span class="p">,</span><span class="s1">&#39;freqAB&#39;</span><span class="p">,</span><span class="s1">&#39;supportAB&#39;</span><span class="p">,</span><span class="s1">&#39;freqA&#39;</span><span class="p">,</span><span class="s1">&#39;supportA&#39;</span><span class="p">,</span><span class="s1">&#39;freqB&#39;</span><span class="p">,</span><span class="s1">&#39;supportB&#39;</span><span class="p">,</span> 
               <span class="s1">&#39;confidenceAtoB&#39;</span><span class="p">,</span><span class="s1">&#39;confidenceBtoA&#39;</span><span class="p">,</span><span class="s1">&#39;lift&#39;</span><span class="p">]</span>
    <span class="n">rules</span> <span class="o">=</span> <span class="p">(</span><span class="n">rules</span>
                <span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">item_name</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;item_name&#39;</span><span class="p">:</span> <span class="s1">&#39;itemA&#39;</span><span class="p">}),</span> <span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;item_A&#39;</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;item_id&#39;</span><span class="p">)</span>
                <span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">item_name</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;item_name&#39;</span><span class="p">:</span> <span class="s1">&#39;itemB&#39;</span><span class="p">}),</span> <span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;item_B&#39;</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;item_id&#39;</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">rules</span><span class="p">[</span><span class="n">columns</span><span class="p">]</span>               
</pre>
        </div>

      </div>
    </div>
  </div>

</div>
<div class="cell border-box-sizing text_cell rendered">
  <div class="prompt input_prompt">
  </div>
  <div class="inner_cell">
    <div class="text_cell_render border-box-sizing rendered_html">
      <h4 id="B.-Association-rules-function">B. Association rules function<a class="anchor-link" href="#B.-Association-rules-function">&#182;</a></h4>
    </div>
  </div>
</div>
<div class="cell border-box-sizing code_cell rendered">
  <div class="input">
    <div class="prompt input_prompt">In&nbsp;[8]:</div>
    <div class="inner_cell">
      <div class="input_area">
        <div class=" highlight hl-ipython3">
          <pre><span></span><span class="k">def</span> <span class="nf">association_rules</span><span class="p">(</span><span class="n">order_item</span><span class="p">,</span> <span class="n">min_support</span><span class="p">):</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Starting order_item: </span><span class="si">{:22d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">order_item</span><span class="p">)))</span>


    <span class="c1"># Calculate item frequency and support</span>
    <span class="n">item_stats</span>             <span class="o">=</span> <span class="n">freq</span><span class="p">(</span><span class="n">order_item</span><span class="p">)</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s2">&quot;freq&quot;</span><span class="p">)</span>
    <span class="n">item_stats</span><span class="p">[</span><span class="s1">&#39;support&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">item_stats</span><span class="p">[</span><span class="s1">&#39;freq&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">order_count</span><span class="p">(</span><span class="n">order_item</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>


    <span class="c1"># Filter from order_item items below min support </span>
    <span class="n">qualifying_items</span>       <span class="o">=</span> <span class="n">item_stats</span><span class="p">[</span><span class="n">item_stats</span><span class="p">[</span><span class="s1">&#39;support&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">min_support</span><span class="p">]</span><span class="o">.</span><span class="n">index</span>
    <span class="n">order_item</span>             <span class="o">=</span> <span class="n">order_item</span><span class="p">[</span><span class="n">order_item</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">qualifying_items</span><span class="p">)]</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Items with support &gt;= </span><span class="si">{}</span><span class="s2">: </span><span class="si">{:15d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">min_support</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">qualifying_items</span><span class="p">)))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Remaining order_item: </span><span class="si">{:21d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">order_item</span><span class="p">)))</span>


    <span class="c1"># Filter from order_item orders with less than 2 items</span>
    <span class="n">order_size</span>             <span class="o">=</span> <span class="n">freq</span><span class="p">(</span><span class="n">order_item</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
    <span class="n">qualifying_orders</span>      <span class="o">=</span> <span class="n">order_size</span><span class="p">[</span><span class="n">order_size</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">index</span>
    <span class="n">order_item</span>             <span class="o">=</span> <span class="n">order_item</span><span class="p">[</span><span class="n">order_item</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">qualifying_orders</span><span class="p">)]</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Remaining orders with 2+ items: </span><span class="si">{:11d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">qualifying_orders</span><span class="p">)))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Remaining order_item: </span><span class="si">{:21d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">order_item</span><span class="p">)))</span>


    <span class="c1"># Recalculate item frequency and support</span>
    <span class="n">item_stats</span>             <span class="o">=</span> <span class="n">freq</span><span class="p">(</span><span class="n">order_item</span><span class="p">)</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s2">&quot;freq&quot;</span><span class="p">)</span>
    <span class="n">item_stats</span><span class="p">[</span><span class="s1">&#39;support&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">item_stats</span><span class="p">[</span><span class="s1">&#39;freq&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">order_count</span><span class="p">(</span><span class="n">order_item</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>


    <span class="c1"># Get item pairs generator</span>
    <span class="n">item_pair_gen</span>          <span class="o">=</span> <span class="n">get_item_pairs</span><span class="p">(</span><span class="n">order_item</span><span class="p">)</span>


    <span class="c1"># Calculate item pair frequency and support</span>
    <span class="n">item_pairs</span>              <span class="o">=</span> <span class="n">freq</span><span class="p">(</span><span class="n">item_pair_gen</span><span class="p">)</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s2">&quot;freqAB&quot;</span><span class="p">)</span>
    <span class="n">item_pairs</span><span class="p">[</span><span class="s1">&#39;supportAB&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">item_pairs</span><span class="p">[</span><span class="s1">&#39;freqAB&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">qualifying_orders</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Item pairs: </span><span class="si">{:31d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">item_pairs</span><span class="p">)))</span>


    <span class="c1"># Filter from item_pairs those below min support</span>
    <span class="n">item_pairs</span>              <span class="o">=</span> <span class="n">item_pairs</span><span class="p">[</span><span class="n">item_pairs</span><span class="p">[</span><span class="s1">&#39;supportAB&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">min_support</span><span class="p">]</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Item pairs with support &gt;= </span><span class="si">{}</span><span class="s2">: </span><span class="si">{:10d}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">min_support</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">item_pairs</span><span class="p">)))</span>


    <span class="c1"># Create table of association rules and compute relevant metrics</span>
    <span class="n">item_pairs</span> <span class="o">=</span> <span class="n">item_pairs</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;level_0&#39;</span><span class="p">:</span> <span class="s1">&#39;item_A&#39;</span><span class="p">,</span> <span class="s1">&#39;level_1&#39;</span><span class="p">:</span> <span class="s1">&#39;item_B&#39;</span><span class="p">})</span>
    <span class="n">item_pairs</span> <span class="o">=</span> <span class="n">merge_item_stats</span><span class="p">(</span><span class="n">item_pairs</span><span class="p">,</span> <span class="n">item_stats</span><span class="p">)</span>
    
    <span class="n">item_pairs</span><span class="p">[</span><span class="s1">&#39;confidenceAtoB&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">item_pairs</span><span class="p">[</span><span class="s1">&#39;supportAB&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">item_pairs</span><span class="p">[</span><span class="s1">&#39;supportA&#39;</span><span class="p">]</span>
    <span class="n">item_pairs</span><span class="p">[</span><span class="s1">&#39;confidenceBtoA&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">item_pairs</span><span class="p">[</span><span class="s1">&#39;supportAB&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">item_pairs</span><span class="p">[</span><span class="s1">&#39;supportB&#39;</span><span class="p">]</span>
    <span class="n">item_pairs</span><span class="p">[</span><span class="s1">&#39;lift&#39;</span><span class="p">]</span>           <span class="o">=</span> <span class="n">item_pairs</span><span class="p">[</span><span class="s1">&#39;supportAB&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">item_pairs</span><span class="p">[</span><span class="s1">&#39;supportA&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">item_pairs</span><span class="p">[</span><span class="s1">&#39;supportB&#39;</span><span class="p">])</span>
   

    <span class="c1"># Return association rules sorted by lift in descending order</span>
    <span class="k">return</span> <span class="n">item_pairs</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;lift&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre>
        </div>

      </div>
    </div>
  </div>

</div>
<div class="cell border-box-sizing text_cell rendered">
  <div class="prompt input_prompt">
  </div>
  <div class="inner_cell">
    <div class="text_cell_render border-box-sizing rendered_html">
      <h3 id="Part-3:--Association-Rules-Mining">Part 3: Association Rules Mining<a class="anchor-link" href="#Part-3:--Association-Rules-Mining">&#182;</a></h3>
    </div>
  </div>
</div>
<div class="cell border-box-sizing code_cell rendered">
  <div class="input">
    <div class="prompt input_prompt">In&nbsp;[9]:</div>
    <div class="inner_cell">
      <div class="input_area">
        <div class=" highlight hl-ipython3">
          <pre><span></span><span class="o">%%</span><span class="k">time</span>
rules = association_rules(orders, 0.01)  
</pre>
        </div>

      </div>
    </div>
  </div>

  <div class="output_wrapper">
    <div class="output">


      <div class="output_area">

        <div class="prompt"></div>


        <div class="output_subarea output_stream output_stdout output_text">
          <pre>Starting order_item:               32434489
Items with support &gt;= 0.01:           10906
Remaining order_item:              29843570
Remaining orders with 2+ items:     3013325
Remaining order_item:              29662716
Item pairs:                        30622410
Item pairs with support &gt;= 0.01:      48751

CPU times: user 9min 26s, sys: 34.5 s, total: 10min 1s
Wall time: 10min 13s
</pre>
        </div>
      </div>

    </div>
  </div>

</div>
<div class="cell border-box-sizing code_cell rendered">
  <div class="input">
    <div class="prompt input_prompt">In&nbsp;[10]:</div>
    <div class="inner_cell">
      <div class="input_area">
        <div class=" highlight hl-ipython3">
          <pre><span></span><span class="c1"># Replace item ID with item name and display association rules</span>
<span class="n">item_name</span>   <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;products.csv&#39;</span><span class="p">)</span>
<span class="n">item_name</span>   <span class="o">=</span> <span class="n">item_name</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;product_id&#39;</span><span class="p">:</span><span class="s1">&#39;item_id&#39;</span><span class="p">,</span> <span class="s1">&#39;product_name&#39;</span><span class="p">:</span><span class="s1">&#39;item_name&#39;</span><span class="p">})</span>
<span class="n">rules_final</span> <span class="o">=</span> <span class="n">merge_item_name</span><span class="p">(</span><span class="n">rules</span><span class="p">,</span> <span class="n">item_name</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;lift&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">rules_final</span><span class="p">)</span>
</pre>
        </div>

      </div>
    </div>
  </div>

  <div class="output_wrapper">
    <div class="output">


      <div class="output_area">

        <div class="prompt"></div>



        <div class="output_html rendered_html output_subarea ">
          <div>
            <style>
              .dataframe thead tr:only-child th {
                text-align: right;
              }

              .dataframe thead th {
                text-align: left;
              }

              .dataframe tbody tr th {
                vertical-align: top;
              }
            </style>
            <table border="1" class="dataframe">
              <thead>
                <tr style="text-align: right;">
                  <th></th>
                  <th>itemA</th>
                  <th>itemB</th>
                  <th>freqAB</th>
                  <th>supportAB</th>
                  <th>freqA</th>
                  <th>supportA</th>
                  <th>freqB</th>
                  <th>supportB</th>
                  <th>confidenceAtoB</th>
                  <th>confidenceBtoA</th>
                  <th>lift</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <th>0</th>
                  <td>Organic Strawberry Chia Lowfat 2% Cottage Cheese</td>
                  <td>Organic Cottage Cheese Blueberry Acai Chia</td>
                  <td>306</td>
                  <td>0.010155</td>
                  <td>1163</td>
                  <td>0.038595</td>
                  <td>839</td>
                  <td>0.027843</td>
                  <td>0.263113</td>
                  <td>0.364720</td>
                  <td>9.449868</td>
                </tr>
                <tr>
                  <th>1</th>
                  <td>Grain Free Chicken Formula Cat Food</td>
                  <td>Grain Free Turkey Formula Cat Food</td>
                  <td>318</td>
                  <td>0.010553</td>
                  <td>1809</td>
                  <td>0.060033</td>
                  <td>879</td>
                  <td>0.029170</td>
                  <td>0.175788</td>
                  <td>0.361775</td>
                  <td>6.026229</td>
                </tr>
                <tr>
                  <th>3</th>
                  <td>Organic Fruit Yogurt Smoothie Mixed Berry</td>
                  <td>Apple Blueberry Fruit Yogurt Smoothie</td>
                  <td>349</td>
                  <td>0.011582</td>
                  <td>1518</td>
                  <td>0.050376</td>
                  <td>1249</td>
                  <td>0.041449</td>
                  <td>0.229908</td>
                  <td>0.279424</td>
                  <td>5.546732</td>
                </tr>
                <tr>
                  <th>9</th>
                  <td>Nonfat Strawberry With Fruit On The Bottom Gre...</td>
                  <td>0% Greek, Blueberry on the Bottom Yogurt</td>
                  <td>409</td>
                  <td>0.013573</td>
                  <td>1666</td>
                  <td>0.055288</td>
                  <td>1391</td>
                  <td>0.046162</td>
                  <td>0.245498</td>
                  <td>0.294033</td>
                  <td>5.318230</td>
                </tr>
                <tr>
                  <th>10</th>
                  <td>Organic Grapefruit Ginger Sparkling Yerba Mate</td>
                  <td>Cranberry Pomegranate Sparkling Yerba Mate</td>
                  <td>351</td>
                  <td>0.011648</td>
                  <td>1731</td>
                  <td>0.057445</td>
                  <td>1149</td>
                  <td>0.038131</td>
                  <td>0.202773</td>
                  <td>0.305483</td>
                  <td>5.317849</td>
                </tr>
                <tr>
                  <th>11</th>
                  <td>Baby Food Pouch - Roasted Carrot Spinach &amp; Beans</td>
                  <td>Baby Food Pouch - Butternut Squash, Carrot &amp; C...</td>
                  <td>332</td>
                  <td>0.011018</td>
                  <td>1503</td>
                  <td>0.049878</td>
                  <td>1290</td>
                  <td>0.042810</td>
                  <td>0.220892</td>
                  <td>0.257364</td>
                  <td>5.159830</td>
                </tr>
                <tr>
                  <th>12</th>
                  <td>Unsweetened Whole Milk Mixed Berry Greek Yogurt</td>
                  <td>Unsweetened Whole Milk Blueberry Greek Yogurt</td>
                  <td>438</td>
                  <td>0.014535</td>
                  <td>1622</td>
                  <td>0.053828</td>
                  <td>1621</td>
                  <td>0.053794</td>
                  <td>0.270037</td>
                  <td>0.270204</td>
                  <td>5.019798</td>
                </tr>
                <tr>
                  <th>23</th>
                  <td>Uncured Cracked Pepper Beef</td>
                  <td>Chipotle Beef &amp; Pork Realstick</td>
                  <td>410</td>
                  <td>0.013606</td>
                  <td>1839</td>
                  <td>0.061029</td>
                  <td>1370</td>
                  <td>0.045465</td>
                  <td>0.222947</td>
                  <td>0.299270</td>
                  <td>4.903741</td>
                </tr>
                <tr>
                  <th>24</th>
                  <td>Organic Mango Yogurt</td>
                  <td>Organic Whole Milk Washington Black Cherry Yogurt</td>
                  <td>334</td>
                  <td>0.011084</td>
                  <td>1675</td>
                  <td>0.055586</td>
                  <td>1390</td>
                  <td>0.046128</td>
                  <td>0.199403</td>
                  <td>0.240288</td>
                  <td>4.322777</td>
                </tr>
                <tr>
                  <th>2</th>
                  <td>Grain Free Chicken Formula Cat Food</td>
                  <td>Grain Free Turkey &amp; Salmon Formula Cat Food</td>
                  <td>391</td>
                  <td>0.012976</td>
                  <td>1809</td>
                  <td>0.060033</td>
                  <td>1553</td>
                  <td>0.051538</td>
                  <td>0.216142</td>
                  <td>0.251771</td>
                  <td>4.193848</td>
                </tr>
                <tr>
                  <th>25</th>
                  <td>Raspberry Essence Water</td>
                  <td>Unsweetened Pomegranate Essence Water</td>
                  <td>366</td>
                  <td>0.012146</td>
                  <td>2025</td>
                  <td>0.067202</td>
                  <td>1304</td>
                  <td>0.043274</td>
                  <td>0.180741</td>
                  <td>0.280675</td>
                  <td>4.176615</td>
                </tr>
                <tr>
                  <th>13</th>
                  <td>Unsweetened Whole Milk Strawberry Yogurt</td>
                  <td>Unsweetened Whole Milk Blueberry Greek Yogurt</td>
                  <td>440</td>
                  <td>0.014602</td>
                  <td>1965</td>
                  <td>0.065210</td>
                  <td>1621</td>
                  <td>0.053794</td>
                  <td>0.223919</td>
                  <td>0.271437</td>
                  <td>4.162489</td>
                </tr>
                <tr>
                  <th>14</th>
                  <td>Unsweetened Whole Milk Peach Greek Yogurt</td>
                  <td>Unsweetened Whole Milk Blueberry Greek Yogurt</td>
                  <td>421</td>
                  <td>0.013971</td>
                  <td>1922</td>
                  <td>0.063783</td>
                  <td>1621</td>
                  <td>0.053794</td>
                  <td>0.219043</td>
                  <td>0.259716</td>
                  <td>4.071849</td>
                </tr>
                <tr>
                  <th>44</th>
                  <td>Oh My Yog! Pacific Coast Strawberry Trilayer Y...</td>
                  <td>Oh My Yog! Organic Wild Quebec Blueberry Cream...</td>
                  <td>860</td>
                  <td>0.028540</td>
                  <td>2857</td>
                  <td>0.094812</td>
                  <td>2271</td>
                  <td>0.075365</td>
                  <td>0.301015</td>
                  <td>0.378688</td>
                  <td>3.994083</td>
                </tr>
                <tr>
                  <th>55</th>
                  <td>Mighty 4 Kale, Strawberry, Amaranth &amp; Greek Yo...</td>
                  <td>Mighty 4 Essential Tots Spinach, Kiwi, Barley ...</td>
                  <td>390</td>
                  <td>0.012943</td>
                  <td>2206</td>
                  <td>0.073208</td>
                  <td>1337</td>
                  <td>0.044370</td>
                  <td>0.176791</td>
                  <td>0.291698</td>
                  <td>3.984498</td>
                </tr>
                <tr>
                  <th>20</th>
                  <td>Unsweetened Whole Milk Peach Greek Yogurt</td>
                  <td>Unsweetened Whole Milk Strawberry Yogurt</td>
                  <td>499</td>
                  <td>0.016560</td>
                  <td>1922</td>
                  <td>0.063783</td>
                  <td>1965</td>
                  <td>0.065210</td>
                  <td>0.259625</td>
                  <td>0.253944</td>
                  <td>3.981352</td>
                </tr>
                <tr>
                  <th>65</th>
                  <td>0% Greek, Blueberry on the Bottom Yogurt</td>
                  <td>Nonfat Strawberry With Fruit On The Bottom Gre...</td>
                  <td>305</td>
                  <td>0.010122</td>
                  <td>1391</td>
                  <td>0.046162</td>
                  <td>1666</td>
                  <td>0.055288</td>
                  <td>0.219267</td>
                  <td>0.183073</td>
                  <td>3.965918</td>
                </tr>
                <tr>
                  <th>15</th>
                  <td>Unsweetened Whole Milk Mixed Berry Greek Yogurt</td>
                  <td>Unsweetened Whole Milk Peach Greek Yogurt</td>
                  <td>410</td>
                  <td>0.013606</td>
                  <td>1622</td>
                  <td>0.053828</td>
                  <td>1922</td>
                  <td>0.063783</td>
                  <td>0.252774</td>
                  <td>0.213319</td>
                  <td>3.963014</td>
                </tr>
                <tr>
                  <th>43</th>
                  <td>Unsweetened Whole Milk Peach Greek Yogurt</td>
                  <td>Unsweetened Whole Milk Mixed Berry Greek Yogurt</td>
                  <td>407</td>
                  <td>0.013507</td>
                  <td>1922</td>
                  <td>0.063783</td>
                  <td>1622</td>
                  <td>0.053828</td>
                  <td>0.211759</td>
                  <td>0.250925</td>
                  <td>3.934016</td>
                </tr>
                <tr>
                  <th>26</th>
                  <td>Unsweetened Blackberry Water</td>
                  <td>Unsweetened Pomegranate Essence Water</td>
                  <td>494</td>
                  <td>0.016394</td>
                  <td>3114</td>
                  <td>0.103341</td>
                  <td>1304</td>
                  <td>0.043274</td>
                  <td>0.158638</td>
                  <td>0.378834</td>
                  <td>3.665867</td>
                </tr>
                <tr>
                  <th>19</th>
                  <td>Unsweetened Whole Milk Mixed Berry Greek Yogurt</td>
                  <td>Unsweetened Whole Milk Strawberry Yogurt</td>
                  <td>383</td>
                  <td>0.012710</td>
                  <td>1622</td>
                  <td>0.053828</td>
                  <td>1965</td>
                  <td>0.065210</td>
                  <td>0.236128</td>
                  <td>0.194911</td>
                  <td>3.621024</td>
                </tr>
                <tr>
                  <th>16</th>
                  <td>Unsweetened Whole Milk Strawberry Yogurt</td>
                  <td>Unsweetened Whole Milk Peach Greek Yogurt</td>
                  <td>444</td>
                  <td>0.014735</td>
                  <td>1965</td>
                  <td>0.065210</td>
                  <td>1922</td>
                  <td>0.063783</td>
                  <td>0.225954</td>
                  <td>0.231009</td>
                  <td>3.542526</td>
                </tr>
                <tr>
                  <th>56</th>
                  <td>Mighty 4 Sweet Potato, Blueberry, Millet &amp; Gre...</td>
                  <td>Mighty 4 Essential Tots Spinach, Kiwi, Barley ...</td>
                  <td>398</td>
                  <td>0.013208</td>
                  <td>2534</td>
                  <td>0.084093</td>
                  <td>1337</td>
                  <td>0.044370</td>
                  <td>0.157064</td>
                  <td>0.297681</td>
                  <td>3.539900</td>
                </tr>
                <tr>
                  <th>74</th>
                  <td>Sweet Potatoes Stage 2</td>
                  <td>Organic Stage 2 Winter Squash Baby Food Puree</td>
                  <td>322</td>
                  <td>0.010686</td>
                  <td>2077</td>
                  <td>0.068927</td>
                  <td>1322</td>
                  <td>0.043872</td>
                  <td>0.155031</td>
                  <td>0.243570</td>
                  <td>3.533734</td>
                </tr>
                <tr>
                  <th>79</th>
                  <td>Compostable Forks</td>
                  <td>Plastic Spoons</td>
                  <td>321</td>
                  <td>0.010653</td>
                  <td>1528</td>
                  <td>0.050708</td>
                  <td>1838</td>
                  <td>0.060996</td>
                  <td>0.210079</td>
                  <td>0.174646</td>
                  <td>3.444151</td>
                </tr>
                <tr>
                  <th>75</th>
                  <td>Organic Stage 2 Carrots Baby Food</td>
                  <td>Organic Stage 2 Winter Squash Baby Food Puree</td>
                  <td>337</td>
                  <td>0.011184</td>
                  <td>2306</td>
                  <td>0.076527</td>
                  <td>1322</td>
                  <td>0.043872</td>
                  <td>0.146141</td>
                  <td>0.254917</td>
                  <td>3.331080</td>
                </tr>
                <tr>
                  <th>42</th>
                  <td>Unsweetened Whole Milk Strawberry Yogurt</td>
                  <td>Unsweetened Whole Milk Mixed Berry Greek Yogurt</td>
                  <td>352</td>
                  <td>0.011681</td>
                  <td>1965</td>
                  <td>0.065210</td>
                  <td>1622</td>
                  <td>0.053828</td>
                  <td>0.179135</td>
                  <td>0.217016</td>
                  <td>3.327938</td>
                </tr>
                <tr>
                  <th>21</th>
                  <td>Unsweetened Whole Milk Blueberry Greek Yogurt</td>
                  <td>Unsweetened Whole Milk Strawberry Yogurt</td>
                  <td>350</td>
                  <td>0.011615</td>
                  <td>1621</td>
                  <td>0.053794</td>
                  <td>1965</td>
                  <td>0.065210</td>
                  <td>0.215916</td>
                  <td>0.178117</td>
                  <td>3.311071</td>
                </tr>
                <tr>
                  <th>17</th>
                  <td>Unsweetened Whole Milk Blueberry Greek Yogurt</td>
                  <td>Unsweetened Whole Milk Peach Greek Yogurt</td>
                  <td>341</td>
                  <td>0.011316</td>
                  <td>1621</td>
                  <td>0.053794</td>
                  <td>1922</td>
                  <td>0.063783</td>
                  <td>0.210364</td>
                  <td>0.177419</td>
                  <td>3.298101</td>
                </tr>
                <tr>
                  <th>83</th>
                  <td>Cream Top Blueberry Yogurt</td>
                  <td>Cream Top Peach on the Bottom Yogurt</td>
                  <td>313</td>
                  <td>0.010387</td>
                  <td>1676</td>
                  <td>0.055620</td>
                  <td>1748</td>
                  <td>0.058009</td>
                  <td>0.186754</td>
                  <td>0.179062</td>
                  <td>3.219399</td>
                </tr>
                <tr>
                  <th>...</th>
                  <td>...</td>
                  <td>...</td>
                  <td>...</td>
                  <td>...</td>
                  <td>...</td>
                  <td>...</td>
                  <td>...</td>
                  <td>...</td>
                  <td>...</td>
                  <td>...</td>
                  <td>...</td>
                </tr>
                <tr>
                  <th>22444</th>
                  <td>Large Lemon</td>
                  <td>Hass Avocados</td>
                  <td>468</td>
                  <td>0.015531</td>
                  <td>152177</td>
                  <td>5.050136</td>
                  <td>49246</td>
                  <td>1.634274</td>
                  <td>0.003075</td>
                  <td>0.009503</td>
                  <td>0.001882</td>
                </tr>
                <tr>
                  <th>2577</th>
                  <td>Red Onion</td>
                  <td>Bag of Organic Bananas</td>
                  <td>1008</td>
                  <td>0.033451</td>
                  <td>42906</td>
                  <td>1.423876</td>
                  <td>376367</td>
                  <td>12.490090</td>
                  <td>0.023493</td>
                  <td>0.002678</td>
                  <td>0.001881</td>
                </tr>
                <tr>
                  <th>250</th>
                  <td>Roasted Pine Nut Hummus</td>
                  <td>Banana</td>
                  <td>327</td>
                  <td>0.010852</td>
                  <td>11176</td>
                  <td>0.370886</td>
                  <td>470096</td>
                  <td>15.600574</td>
                  <td>0.029259</td>
                  <td>0.000696</td>
                  <td>0.001876</td>
                </tr>
                <tr>
                  <th>655</th>
                  <td>Organic Large Green Asparagus</td>
                  <td>Banana</td>
                  <td>556</td>
                  <td>0.018451</td>
                  <td>19228</td>
                  <td>0.638099</td>
                  <td>470096</td>
                  <td>15.600574</td>
                  <td>0.028916</td>
                  <td>0.001183</td>
                  <td>0.001854</td>
                </tr>
                <tr>
                  <th>40897</th>
                  <td>Banana</td>
                  <td>Organic Extra Virgin Olive Oil</td>
                  <td>369</td>
                  <td>0.012246</td>
                  <td>470096</td>
                  <td>15.600574</td>
                  <td>12788</td>
                  <td>0.424382</td>
                  <td>0.000785</td>
                  <td>0.028855</td>
                  <td>0.001850</td>
                </tr>
                <tr>
                  <th>2652</th>
                  <td>Spinach</td>
                  <td>Bag of Organic Bananas</td>
                  <td>383</td>
                  <td>0.012710</td>
                  <td>16766</td>
                  <td>0.556395</td>
                  <td>376367</td>
                  <td>12.490090</td>
                  <td>0.022844</td>
                  <td>0.001018</td>
                  <td>0.001829</td>
                </tr>
                <tr>
                  <th>2722</th>
                  <td>Sour Cream</td>
                  <td>Bag of Organic Bananas</td>
                  <td>486</td>
                  <td>0.016128</td>
                  <td>21481</td>
                  <td>0.712867</td>
                  <td>376367</td>
                  <td>12.490090</td>
                  <td>0.022625</td>
                  <td>0.001291</td>
                  <td>0.001811</td>
                </tr>
                <tr>
                  <th>11143</th>
                  <td>Organic Blueberries</td>
                  <td>Blueberries</td>
                  <td>329</td>
                  <td>0.010918</td>
                  <td>99359</td>
                  <td>3.297321</td>
                  <td>55703</td>
                  <td>1.848556</td>
                  <td>0.003311</td>
                  <td>0.005906</td>
                  <td>0.001791</td>
                </tr>
                <tr>
                  <th>2537</th>
                  <td>Green Onions</td>
                  <td>Bag of Organic Bananas</td>
                  <td>592</td>
                  <td>0.019646</td>
                  <td>26467</td>
                  <td>0.878332</td>
                  <td>376367</td>
                  <td>12.490090</td>
                  <td>0.022367</td>
                  <td>0.001573</td>
                  <td>0.001791</td>
                </tr>
                <tr>
                  <th>1386</th>
                  <td>2% Reduced Fat Milk</td>
                  <td>Organic Strawberries</td>
                  <td>574</td>
                  <td>0.019049</td>
                  <td>36768</td>
                  <td>1.220180</td>
                  <td>263416</td>
                  <td>8.741706</td>
                  <td>0.015611</td>
                  <td>0.002179</td>
                  <td>0.001786</td>
                </tr>
                <tr>
                  <th>3291</th>
                  <td>2% Reduced Fat Milk</td>
                  <td>Organic Baby Spinach</td>
                  <td>523</td>
                  <td>0.017356</td>
                  <td>36768</td>
                  <td>1.220180</td>
                  <td>240637</td>
                  <td>7.985763</td>
                  <td>0.014224</td>
                  <td>0.002173</td>
                  <td>0.001781</td>
                </tr>
                <tr>
                  <th>530</th>
                  <td>Chocolate Chip Cookies</td>
                  <td>Banana</td>
                  <td>377</td>
                  <td>0.012511</td>
                  <td>13688</td>
                  <td>0.454249</td>
                  <td>470096</td>
                  <td>15.600574</td>
                  <td>0.027542</td>
                  <td>0.000802</td>
                  <td>0.001765</td>
                </tr>
                <tr>
                  <th>10681</th>
                  <td>Half &amp; Half</td>
                  <td>Organic Half &amp; Half</td>
                  <td>302</td>
                  <td>0.010022</td>
                  <td>68842</td>
                  <td>2.284586</td>
                  <td>75334</td>
                  <td>2.500029</td>
                  <td>0.004387</td>
                  <td>0.004009</td>
                  <td>0.001755</td>
                </tr>
                <tr>
                  <th>5446</th>
                  <td>Organic Reduced Fat 2% Milk</td>
                  <td>Organic Whole Milk</td>
                  <td>379</td>
                  <td>0.012577</td>
                  <td>47593</td>
                  <td>1.579418</td>
                  <td>136832</td>
                  <td>4.540898</td>
                  <td>0.007963</td>
                  <td>0.002770</td>
                  <td>0.001754</td>
                </tr>
                <tr>
                  <th>11455</th>
                  <td>Banana</td>
                  <td>Soda</td>
                  <td>864</td>
                  <td>0.028673</td>
                  <td>470096</td>
                  <td>15.600574</td>
                  <td>33008</td>
                  <td>1.095401</td>
                  <td>0.001838</td>
                  <td>0.026175</td>
                  <td>0.001678</td>
                </tr>
                <tr>
                  <th>11421</th>
                  <td>Bag of Organic Bananas</td>
                  <td>Fridge Pack Cola</td>
                  <td>366</td>
                  <td>0.012146</td>
                  <td>376367</td>
                  <td>12.490090</td>
                  <td>18005</td>
                  <td>0.597513</td>
                  <td>0.000972</td>
                  <td>0.020328</td>
                  <td>0.001628</td>
                </tr>
                <tr>
                  <th>2568</th>
                  <td>Asparation/Broccolini/Baby Broccoli</td>
                  <td>Bag of Organic Bananas</td>
                  <td>317</td>
                  <td>0.010520</td>
                  <td>16480</td>
                  <td>0.546904</td>
                  <td>376367</td>
                  <td>12.490090</td>
                  <td>0.019235</td>
                  <td>0.000842</td>
                  <td>0.001540</td>
                </tr>
                <tr>
                  <th>19596</th>
                  <td>Banana</td>
                  <td>Organic Tortilla Chips</td>
                  <td>320</td>
                  <td>0.010619</td>
                  <td>470096</td>
                  <td>15.600574</td>
                  <td>13458</td>
                  <td>0.446616</td>
                  <td>0.000681</td>
                  <td>0.023778</td>
                  <td>0.001524</td>
                </tr>
                <tr>
                  <th>2319</th>
                  <td>Fridge Pack Cola</td>
                  <td>Bag of Organic Bananas</td>
                  <td>341</td>
                  <td>0.011316</td>
                  <td>18005</td>
                  <td>0.597513</td>
                  <td>376367</td>
                  <td>12.490090</td>
                  <td>0.018939</td>
                  <td>0.000906</td>
                  <td>0.001516</td>
                </tr>
                <tr>
                  <th>11017</th>
                  <td>Organic Baby Spinach</td>
                  <td>2% Reduced Fat Milk</td>
                  <td>403</td>
                  <td>0.013374</td>
                  <td>240637</td>
                  <td>7.985763</td>
                  <td>36768</td>
                  <td>1.220180</td>
                  <td>0.001675</td>
                  <td>0.010961</td>
                  <td>0.001373</td>
                </tr>
                <tr>
                  <th>22572</th>
                  <td>Organic Raspberries</td>
                  <td>Raspberries</td>
                  <td>322</td>
                  <td>0.010686</td>
                  <td>136621</td>
                  <td>4.533895</td>
                  <td>56858</td>
                  <td>1.886886</td>
                  <td>0.002357</td>
                  <td>0.005663</td>
                  <td>0.001249</td>
                </tr>
                <tr>
                  <th>11012</th>
                  <td>Organic Strawberries</td>
                  <td>2% Reduced Fat Milk</td>
                  <td>371</td>
                  <td>0.012312</td>
                  <td>263416</td>
                  <td>8.741706</td>
                  <td>36768</td>
                  <td>1.220180</td>
                  <td>0.001408</td>
                  <td>0.010090</td>
                  <td>0.001154</td>
                </tr>
                <tr>
                  <th>246</th>
                  <td>Soda</td>
                  <td>Banana</td>
                  <td>531</td>
                  <td>0.017622</td>
                  <td>33008</td>
                  <td>1.095401</td>
                  <td>470096</td>
                  <td>15.600574</td>
                  <td>0.016087</td>
                  <td>0.001130</td>
                  <td>0.001031</td>
                </tr>
                <tr>
                  <th>11555</th>
                  <td>Banana</td>
                  <td>Clementines</td>
                  <td>397</td>
                  <td>0.013175</td>
                  <td>470096</td>
                  <td>15.600574</td>
                  <td>29798</td>
                  <td>0.988874</td>
                  <td>0.000845</td>
                  <td>0.013323</td>
                  <td>0.000854</td>
                </tr>
                <tr>
                  <th>1474</th>
                  <td>Strawberries</td>
                  <td>Organic Strawberries</td>
                  <td>706</td>
                  <td>0.023429</td>
                  <td>141805</td>
                  <td>4.705931</td>
                  <td>263416</td>
                  <td>8.741706</td>
                  <td>0.004979</td>
                  <td>0.002680</td>
                  <td>0.000570</td>
                </tr>
                <tr>
                  <th>7271</th>
                  <td>Organic Strawberries</td>
                  <td>Strawberries</td>
                  <td>640</td>
                  <td>0.021239</td>
                  <td>263416</td>
                  <td>8.741706</td>
                  <td>141805</td>
                  <td>4.705931</td>
                  <td>0.002430</td>
                  <td>0.004513</td>
                  <td>0.000516</td>
                </tr>
                <tr>
                  <th>6763</th>
                  <td>Organic Hass Avocado</td>
                  <td>Organic Avocado</td>
                  <td>464</td>
                  <td>0.015398</td>
                  <td>212785</td>
                  <td>7.061469</td>
                  <td>176241</td>
                  <td>5.848722</td>
                  <td>0.002181</td>
                  <td>0.002633</td>
                  <td>0.000373</td>
                </tr>
                <tr>
                  <th>4387</th>
                  <td>Organic Avocado</td>
                  <td>Organic Hass Avocado</td>
                  <td>443</td>
                  <td>0.014701</td>
                  <td>176241</td>
                  <td>5.848722</td>
                  <td>212785</td>
                  <td>7.061469</td>
                  <td>0.002514</td>
                  <td>0.002082</td>
                  <td>0.000356</td>
                </tr>
                <tr>
                  <th>2596</th>
                  <td>Banana</td>
                  <td>Bag of Organic Bananas</td>
                  <td>654</td>
                  <td>0.021704</td>
                  <td>470096</td>
                  <td>15.600574</td>
                  <td>376367</td>
                  <td>12.490090</td>
                  <td>0.001391</td>
                  <td>0.001738</td>
                  <td>0.000111</td>
                </tr>
                <tr>
                  <th>670</th>
                  <td>Bag of Organic Bananas</td>
                  <td>Banana</td>
                  <td>522</td>
                  <td>0.017323</td>
                  <td>376367</td>
                  <td>12.490090</td>
                  <td>470096</td>
                  <td>15.600574</td>
                  <td>0.001387</td>
                  <td>0.001110</td>
                  <td>0.000089</td>
                </tr>
              </tbody>
            </table>
            <p>48751 rows × 11 columns</p>
          </div>
        </div>

      </div>

    </div>
  </div>

</div>
<div class="cell border-box-sizing text_cell rendered">
  <div class="prompt input_prompt">
  </div>
  <div class="inner_cell">
    <div class="text_cell_render border-box-sizing rendered_html">
      <h3 id="Part-4:--Conclusion">Part 4: Conclusion<a class="anchor-link" href="#Part-4:--Conclusion">&#182;</a></h3>
    </div>
  </div>
</div>
<div class="cell border-box-sizing text_cell rendered">
  <div class="prompt input_prompt">
  </div>
  <div class="inner_cell">
    <div class="text_cell_render border-box-sizing rendered_html">
      <p>From the output above, we see that the top associations are not surprising, with one flavor of an item being purchased
        with another flavor from the same item family (eg: Strawberry Chia Cottage Cheese with Blueberry Acai Cottage Cheese,
        Chicken Cat Food with Turkey Cat Food, etc). As mentioned, one common application of association rules mining is
        in the domain of recommender systems. Once item pairs have been identified as having positive relationship, recommendations
        can be made to customers in order to increase sales. And hopefully, along the way, also introduce customers to items
        they never would have tried before or even imagined existed!  If you wish to see the Python notebook corresponding to 
        the code above, please click <a href="https://github.com/datatheque/datatheque.com/blob/master/notebooks/association_analysis.ipynb">here</a>.</p>

    </div>
  </div>
</div>



    </div>

			
		</div>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
      
    ga('create', 'UA-106401098-1', 'auto');
    ga('send', 'pageview');
</script>
</body>
</html>